apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: erpnext
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://helm.erpnext.com
    targetRevision: "*"
    chart: erpnext
    helm:
      valuesObject:
        image:
          repository: frappe/erpnext
          tag: v15.88.1
          pullPolicy: IfNotPresent

        nginx:
          replicaCount: 1
          service:
            type: ClusterIP
            port: 8080

        worker:
          gunicorn:
            replicaCount: 1
          default:
            replicaCount: 1
          short:
            replicaCount: 1
          long:
            replicaCount: 1
          scheduler:
            replicaCount: 1

        socketio:
          replicaCount: 1

        persistence:
          worker:
            enabled: true
            size: 30Gi
            storageClass: "rook-cephfs"

        mariadb:
          enabled: true
          image:
            registry: docker.io
            repository: bitnami/mariadb
            tag: "latest"
          auth:
            rootPassword: "H$1f*@hc0M"
            username: "erpnext"
            password: "H$1f*@hc0M"
            replicationPassword: "H$1f*@hc0M"
          primary:
            service:
              ports:
                mysql: 3306
            persistence:
              enabled: true
              size: 20Gi
              storageClass: "rook-ceph-block"
            extraFlags: >-
              --skip-character-set-client-handshake
              --skip-innodb-read-only-compressed
              --character-set-server=utf8mb4
              --collation-server=utf8mb4_unicode_ci

        redis-cache:
          enabled: true
          image:
            registry: docker.io
            repository: bitnami/redis
            tag: "latest"
          architecture: standalone
          auth:
            enabled: false
            sentinel: false
          master:
            containerPorts:
              redis: 6379
            persistence:
              enabled: false

        redis-queue:
          enabled: true
          image:
            registry: docker.io
            repository: bitnami/redis
            tag: "latest"
          architecture: standalone
          auth:
            enabled: false
            sentinel: false
          master:
            containerPorts:
              redis: 6379
            persistence:
              enabled: false

        jobs:
          configure:
            enabled: false
            fixVolume: false
  destination:
    server: https://kubernetes.default.svc
    namespace: erpnext
  ignoreDifferences:
    - group: batch
      kind: Job
      jsonPointers:
        - /spec
        - /metadata
  syncPolicy:
    automated:
      prune: false
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
